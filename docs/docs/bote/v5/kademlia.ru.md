# 2. Kademlia (Черновик)

Реализация распределённой хеш-таблицы, используемой в I2P-Bote, отличается от стандартной по следующим пунктам:

* Хранимые данные могут быть удалены из таблицы
* Нет кеширования хранимых данных, т.к. после получения они удаляются
* I2P-Bote использует "списки сиблингов" (S-buckets), как рекомендовано в документации S/Kademlia

Существует 3 типа данных, которые могут быть сохраны на узлах:

* Почтовый пакет
* Индексный пакет
* Контакт

## Индексный пакет
Индексный пакет содержит DHT-ключи одного и более пакетов писем.
DHT-ключ самого индексного пакета является SHA-256 хэшем Пункта Назначения Письма, для которого предназначены письма.
Для проверки наличия новых пактов для выбранного Пункта Назначения Письма узел делает запрос в DHT на наличие Индексных пакетов для Пункта Назначения Письма. Затем он делает запрос по каждому DHT-ключу почтовых пакетов, которые перечислены в индексных пакетах
Когда все компоненты письма из индексов получены, письмо расшифровывается, восстанавливается и помещается во `Входящие`.

Для удаления почтового пакета или записи из индекса должен быть отправлен запрос на удаление, который содержит правильную Авторизацию Удаления, из которой алгоритмом SHA-256 будет получен Хэш Подтверждения Удаления.   
Авторизация Удаления находится внутри каждой зашифрованной части письма.   
Это означает, что третья сторона не может удалить почтовый пакет без его расшифровки и получения Авторизации Удаления.
Узел, получивший запрос на удаление пакета, может перенаправлять запрос другим узлам, на случай, если они не получили подобного запроса.   

Для удаления элемента в Индексном Пакете необходима та же Авторизация Удаления, что и для почтового пакета, которому эта запись соответствует.

ToDo Контакты
